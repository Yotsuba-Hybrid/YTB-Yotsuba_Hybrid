name: Setup New Project

# 游꿢 Se activa en el primer push a CUALQUIERA de estas ramas.
# Al incluir 'develop', aseguramos que funcione si esa es tu rama por defecto.
on:
  push:
    branches: [ "main", "master", "develop", "YTB-Master" ]

permissions:
  contents: write

jobs:
  rename-project:
    if: github.repository != 'Yotsuba-Hybrid/YTB-Yotsuba_Hybrid'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          # Sin 'ref', usa por defecto la rama activa (develop/main)
          fetch-depth: 0 

      - name: Renombrar 'SandBoxGame' al nuevo nombre
        run: |
          OLD_NAME="SandBoxGame"
          REPO_NAME="${{ github.event.repository.name }}"
           
          # Transformaci칩n a PascalCase (ej. my-game -> MyGame)
          REPO_LOWER=$(echo "$REPO_NAME" | tr '[:upper:]' '[:lower:]')
          NEW_NAME=$(echo "$REPO_LOWER" | sed -E 's/(^|[-_])([a-z0-9])/\U\2/g')
           
          echo "Renombrando: $OLD_NAME -> $NEW_NAME"

          if [ "$NEW_NAME" == "$OLD_NAME" ]; then
            echo "El nombre ya es correcto. No hay nada que renombrar."
            exit 0
          fi

          # 1. Reemplazo de contenido
          grep -rl "$OLD_NAME" . --exclude-dir=.git --exclude=".github/workflows/setup.yml" --exclude=".github/workflows/setup.yaml" | while read -r file ; do
            sed -i "s/$OLD_NAME/$NEW_NAME/g" "$file"
          done

          # 2. Renombrado de archivos y carpetas
          # Nota: Se agreg칩 'sort -r' impl칤cito al usar -depth para renombrar desde lo m치s profundo hacia afuera
          find . -depth -name "*$OLD_NAME*" -not -path '*/.git/*' | while read -r path ; do
            dir=$(dirname "$path")
            filename=$(basename "$path")
            # Reemplazo de string bash
            new_filename="${filename//$OLD_NAME/$NEW_NAME}"
            mv "$path" "$dir/$new_filename"
          done

      - name: Guardar cambios
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Setup: Proyecto configurado como $NEW_NAME"
          # Al quitar 'branch', el action detecta autom치ticamente que debe hacer push a la rama actual
